{"metadata":{"uuid":"652ef6e7-9b33-4e02-a36c-e64e12bdc6c6","timestamp":"2024-09-23T07:14:58.440242700Z","projectName":"borrarIAC2","directory":"C:\\projects\\test_repos\\github\\iac_pipeline","baselineFile":"C:\\projects\\test_repos\\github\\iac_pipeline\\.xygeni.iac.baseline.json","developerHashes":[],"sourceType":"REPO","scanType":"iac","scm":{"kind":"github","url":"https://github.com/prueba/iac_pipeline.git","fullName":"prueba/iac_pipeline","branch":"origin/develop","defaultBranch":"origin/main","visibility":"private"},"baseline":true,"format":"iac-xygeni"},"flaws":[{"type":"network","detector":"no_healthcheck","framework":"dockerfile","provider":"docker","location":{"filepath":"iac/Dockerfile","beginLine":1,"endLine":1,"code":"FROM ubuntu:latest"},"severity":"low","explanation":"Healthcheck instructions have not been added to container image","resource":"ubuntu:latest","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.network.no_healthcheck.iac/Dockerfile.1"},{"type":"gensec","detector":"allow_privilege_escalation","framework":"kubernetes","provider":"kubernetes","location":{"filepath":"iac/metadata-db/templates/deployment.yaml","beginLine":4,"endLine":4,"code":"  name: {{ include \"fedml-model-inference-ingress.fullname\" . }}"},"severity":"low","explanation":"Container runs with AllowPrivilegeEscalation","resource":"iac/metadata-db/templates/deployment.yaml:Deployment:","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.gensec.allow_privilege_escalation.iac/metadata-db/templates/deployment.yaml.4"},{"type":"gensec","detector":"lb_deletion_disabled","framework":"terraform","provider":"aws","location":{"filepath":"iac/main.tf","beginLine":59,"endLine":64,"code":"resource \"aws_lb\" \"example\" {\n  name               = var.cluster_name\n  load_balancer_type = \"application\"\n  subnets            = data.aws_subnets.default.ids\n  security_groups    = [aws_security_group.alb.id]\n}"},"severity":"high","explanation":"Load Balancer has deletion protection disabled - enable_deletion_protection is false by default","resource":"iac/main.tf:aws_lb:example","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.gensec.lb_deletion_disabled.iac/main.tf.59"},{"type":"network","detector":"rdp_access_restricted","framework":"arm","provider":"azure","location":{"filepath":"iac/arm_vm.json","beginLine":50,"endLine":73,"code":"{\n      \"type\": \"Microsoft.Network/networkSecurityGroups\",\n      \"apiVersion\": \"2020-05-01\",\n      \"name\": \"[variables('networkSecurityGroupName')]\",\n      \"location\": \"[parameters('location')]\",\n      \"properties\": {\n        \"securityRules\": [\n          {\n            \"name\": \"ssh_rule\",\n            \"properties\": {\n              \"description\": \"Locks inbound down to ssh default port 22.\",\n              \"protocol\": \"Tcp\",\n              \"sourcePortRange\": \"*\",\n              \"destinationPortRange\": \"*\",\n              \"sourceAddressPrefix\": \"*\",\n              \"destinationAddressPrefix\": \"*\",\n              \"access\": \"Allow\",\n              \"priority\": 12,\n              \"direction\": \"Inbound\"\n            }\n          }\n        ]\n      }\n    }"},"severity":"critical","explanation":"RDP Internet access is not restricted","resource":"iac/arm_vm.json:Microsoft.Network/networkSecurityGroups:iac/arm_vm.json.[concat(parameters('projectName'), '-nsg')]","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.network.rdp_access_restricted.iac/arm_vm.json.50"},{"type":"encryption","detector":"api_server_encryption_providers","framework":"kubernetes","provider":"kubernetes","location":{"filepath":"iac/k8s/kube-apiserver.yaml","beginLine":8,"endLine":8,"code":"'kube-apiserver'"},"severity":"high","explanation":"Encryption providers are not properly configured","resource":"iac/k8s/kube-apiserver.yaml:Pod:kube-apiserver","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.encryption.api_server_encryption_providers.iac/k8s/kube-apiserver.yaml.8"},{"type":"gensec","detector":"share_host_network_namespace","framework":"kubernetes","provider":"kubernetes","location":{"filepath":"iac/k8s/kube-apiserver.yaml","beginLine":8,"endLine":8,"code":"'kube-apiserver'"},"severity":"low","explanation":"Host network namespace sharing is allowed","resource":"iac/k8s/kube-apiserver.yaml:Pod:kube-apiserver","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.gensec.share_host_network_namespace.iac/k8s/kube-apiserver.yaml.8"},{"type":"network","detector":"ssh_access_restricted","framework":"arm","provider":"azure","location":{"filepath":"iac/arm_vm.json","beginLine":86,"endLine":109,"code":"{\n      \"comments\": \"Simple Network Security Group for subnet [variables('vNetSubnetName')]\",\n      \"type\": \"Microsoft.Network/networkSecurityGroups\",\n      \"apiVersion\": \"2020-05-01\",\n      \"name\": \"[variables('networkSecurityGroupName2')]\",\n      \"location\": \"[parameters('location')]\",\n      \"properties\": {\n        \"securityRules\": [\n          {\n            \"name\": \"default-allow-22\",\n            \"properties\": {\n              \"priority\": 1000,\n              \"access\": \"Allow\",\n              \"direction\": \"Inbound\",\n              \"destinationPortRange\": \"22\",\n              \"protocol\": \"Tcp\",\n              \"sourceAddressPrefix\": \"*\",\n              \"sourcePortRange\": \"*\",\n              \"destinationAddressPrefix\": \"*\"\n            }\n          }\n        ]\n      }\n    }"},"severity":"critical","explanation":"SSH Internet access is not restricted","resource":"iac/arm_vm.json:Microsoft.Network/networkSecurityGroups:iac/arm_vm.json.default-nsg","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.network.ssh_access_restricted.iac/arm_vm.json.86"},{"type":"network","detector":"ssh_access_restricted","framework":"arm","provider":"azure","location":{"filepath":"iac/arm_vm.json","beginLine":50,"endLine":73,"code":"{\n      \"type\": \"Microsoft.Network/networkSecurityGroups\",\n      \"apiVersion\": \"2020-05-01\",\n      \"name\": \"[variables('networkSecurityGroupName')]\",\n      \"location\": \"[parameters('location')]\",\n      \"properties\": {\n        \"securityRules\": [\n          {\n            \"name\": \"ssh_rule\",\n            \"properties\": {\n              \"description\": \"Locks inbound down to ssh default port 22.\",\n              \"protocol\": \"Tcp\",\n              \"sourcePortRange\": \"*\",\n              \"destinationPortRange\": \"*\",\n              \"sourceAddressPrefix\": \"*\",\n              \"destinationAddressPrefix\": \"*\",\n              \"access\": \"Allow\",\n              \"priority\": 12,\n              \"direction\": \"Inbound\"\n            }\n          }\n        ]\n      }\n    }"},"severity":"critical","explanation":"SSH Internet access is not restricted","resource":"iac/arm_vm.json:Microsoft.Network/networkSecurityGroups:iac/arm_vm.json.[concat(parameters('projectName'), '-nsg')]","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.network.ssh_access_restricted.iac/arm_vm.json.50"},{"type":"logging","detector":"api_server_audit_log_path","framework":"kubernetes","provider":"kubernetes","location":{"filepath":"iac/k8s/kube-apiserver.yaml","beginLine":8,"endLine":8,"code":"'kube-apiserver'"},"severity":"low","explanation":"Persistent audit log not enabled","resource":"iac/k8s/kube-apiserver.yaml:Pod:kube-apiserver","properties":{},"tags":["in-app-code","non-reachable"],"issueId":"IAC.logging.api_server_audit_log_path.iac/k8s/kube-apiserver.yaml.8"},{"type":"network","detector":"api_server_service_account_key_file","framework":"kubernetes","provider":"kubernetes","location":{"filepath":"iac/k8s/kube-apiserver.yaml","beginLine":8,"endLine":8,"code":"'kube-apiserver'"},"severity":"low","explanation":"No service account public key file","resource":"iac/k8s/kube-apiserver.yaml:Pod:kube-apiserver","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.network.api_server_service_account_key_file.iac/k8s/kube-apiserver.yaml.8"},{"type":"network","detector":"api_server_enable_admission_plugins_node_restriction","framework":"kubernetes","provider":"kubernetes","location":{"filepath":"iac/k8s/kube-apiserver.yaml","beginLine":8,"endLine":8,"code":"'kube-apiserver'"},"severity":"low","explanation":"The admission control plugin NodeRestriction is not set","resource":"iac/k8s/kube-apiserver.yaml:Pod:kube-apiserver","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.network.api_server_enable_admission_plugins_node_restriction.iac/k8s/kube-apiserver.yaml.8"},{"type":"gensec","detector":"lb_use_tls","framework":"terraform","provider":"aws","location":{"filepath":"iac/main.tf","beginLine":66,"endLine":83,"code":"resource \"aws_lb_listener\" \"http\" {\n  load_balancer_arn = aws_lb.example.arn\n\n  port              = local.http_port\n\n  protocol          = \"HTTP\"\n\n  # By default, return a simple 404 page\n  default_action {\n    type = \"fixed-response\"\n\n    fixed_response {\n      content_type = \"text/plain\"\n      message_body = \"404: page not found\"\n      status_code  = 404\n    }\n  }\n}"},"severity":"critical","explanation":"Load balancer is using insecure TLS policy - HTTP listener does not redirect to HTTPS","resource":"iac/main.tf:aws_lb_listener:http","properties":{"protocol":"HTTP"},"tags":["in-app-code","reachable"],"issueId":"IAC.gensec.lb_use_tls.iac/main.tf.66"},{"type":"encryption","detector":"api_server_etcd_ca_file","framework":"kubernetes","provider":"kubernetes","location":{"filepath":"iac/k8s/kube-apiserver.yaml","beginLine":8,"endLine":8,"code":"'kube-apiserver'"},"severity":"high","explanation":"No Certificate Authority file set for etcd","resource":"iac/k8s/kube-apiserver.yaml:Pod:kube-apiserver","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.encryption.api_server_etcd_ca_file.iac/k8s/kube-apiserver.yaml.8"},{"type":"gensec","detector":"allow_privilege_escalation","framework":"kubernetes","provider":"kubernetes","location":{"filepath":"iac/k8s/kube-apiserver.yaml","beginLine":8,"endLine":8,"code":"'kube-apiserver'"},"severity":"low","explanation":"Container runs with AllowPrivilegeEscalation","resource":"iac/k8s/kube-apiserver.yaml:Pod:kube-apiserver","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.gensec.allow_privilege_escalation.iac/k8s/kube-apiserver.yaml.8"},{"type":"convention","detector":"unpinned_version_base_image","framework":"dockerfile","provider":"docker","location":{"filepath":"iac/Dockerfile","beginLine":1,"endLine":1,"code":"FROM ubuntu:latest"},"severity":"high","explanation":"Unpinned version for base image","resource":"ubuntu:latest","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.convention.unpinned_version_base_image.iac/Dockerfile.1"},{"type":"gensec","detector":"api_server_enable_admission_plugins_always_pull_images","framework":"kubernetes","provider":"kubernetes","location":{"filepath":"iac/k8s/kube-apiserver.yaml","beginLine":8,"endLine":8,"code":"'kube-apiserver'"},"severity":"low","explanation":"The admission control plugin AlwaysPullImages is not set","resource":"iac/k8s/kube-apiserver.yaml:Pod:kube-apiserver","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.gensec.api_server_enable_admission_plugins_always_pull_images.iac/k8s/kube-apiserver.yaml.8"},{"type":"appsec","detector":"container_runs_as_root","framework":"dockerfile","provider":"docker","location":{"filepath":"iac/Dockerfile","beginLine":1,"endLine":1,"code":"FROM ubuntu:latest"},"severity":"high","explanation":"No USER non-root found, containers for image might run as root","resource":"ubuntu:latest","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.appsec.container_runs_as_root.iac/Dockerfile.1"},{"type":"encryption","detector":"api_server_service_account_lookup","framework":"kubernetes","provider":"kubernetes","location":{"filepath":"iac/k8s/kube-apiserver.yaml","beginLine":8,"endLine":8,"code":"'kube-apiserver'"},"severity":"low","explanation":"Service account lookup not set","resource":"iac/k8s/kube-apiserver.yaml:Pod:kube-apiserver","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.encryption.api_server_service_account_lookup.iac/k8s/kube-apiserver.yaml.8"},{"type":"gensec","detector":"docker_socket_volume","framework":"kubernetes","provider":"kubernetes","location":{"filepath":"iac/metadata-db/templates/deployment.yaml","beginLine":4,"endLine":4,"code":"  name: {{ include \"fedml-model-inference-ingress.fullname\" . }}"},"severity":"low","explanation":"Docker daemon socket exposed to containers","resource":"iac/metadata-db/templates/deployment.yaml:Deployment:","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.gensec.docker_socket_volume.iac/metadata-db/templates/deployment.yaml.4"},{"type":"encryption","detector":"api_server_kubelet_client_cert_and_key","framework":"kubernetes","provider":"kubernetes","location":{"filepath":"iac/k8s/kube-apiserver.yaml","beginLine":8,"endLine":8,"code":"'kube-apiserver'"},"severity":"high","explanation":"Client certificate / key for apiserver not set","resource":"iac/k8s/kube-apiserver.yaml:Pod:kube-apiserver","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.encryption.api_server_kubelet_client_cert_and_key.iac/k8s/kube-apiserver.yaml.8"},{"type":"gensec","detector":"azure_instance_password","framework":"arm","provider":"azure","location":{"filepath":"iac/arm_vm.json","beginLine":164,"endLine":198,"code":"{\n      \"type\": \"Microsoft.Compute/virtualMachines\",\n      \"apiVersion\": \"2021-11-01\",\n      \"name\": \"[variables('vmName')]\",\n      \"location\": \"[parameters('location')]\",\n      \"dependsOn\": [\n        \"[resourceId('Microsoft.Network/networkInterfaces', variables('networkInterfaceName'))]\"\n      ],\n      \"properties\": {\n        \"hardwareProfile\": {\n          \"vmSize\": \"[parameters('vmSize')]\"\n        },\n        \"osProfile\": {\n          \"allowExtensionOperations\": false\n        },\n        \"storageProfile\": {\n          \"imageReference\": {\n            \"publisher\": \"Canonical\",\n            \"offer\": \"UbuntuServer\",\n            \"sku\": \"18_04-lts-gen2\",\n            \"version\": \"latest\"\n          },\n          \"osDisk\": {\n            \"createOption\": \"fromImage\"\n          }\n        },\n        \"networkProfile\": {\n          \"networkInterfaces\": [\n            {\n              \"id\": \"[resourceId('Microsoft.Network/networkInterfaces', variables('networkInterfaceName'))]\"\n            }\n          ]\n        }\n      }\n    }"},"severity":"high","explanation":"Azure linux instance with password authentication","resource":"iac/arm_vm.json:Microsoft.Compute/virtualMachines:iac/arm_vm.json.[concat(parameters('projectName'), '-vm')]","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.gensec.azure_instance_password.iac/arm_vm.json.164"},{"type":"encryption","detector":"api_server_tls_cert_and_key","framework":"kubernetes","provider":"kubernetes","location":{"filepath":"iac/k8s/kube-apiserver.yaml","beginLine":8,"endLine":8,"code":"'kube-apiserver'"},"severity":"low","explanation":"Apiserver does not set TLS key and certificate","resource":"iac/k8s/kube-apiserver.yaml:Pod:kube-apiserver","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.encryption.api_server_tls_cert_and_key.iac/k8s/kube-apiserver.yaml.8"},{"type":"encryption","detector":"api_server_etcd_cert_and_key","framework":"kubernetes","provider":"kubernetes","location":{"filepath":"iac/k8s/kube-apiserver.yaml","beginLine":8,"endLine":8,"code":"'kube-apiserver'"},"severity":"high","explanation":"Certificate or Key file not set for etcd","resource":"iac/k8s/kube-apiserver.yaml:Pod:kube-apiserver","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.encryption.api_server_etcd_cert_and_key.iac/k8s/kube-apiserver.yaml.8"},{"type":"network","detector":"api_server_insecure_port","framework":"kubernetes","provider":"kubernetes","location":{"filepath":"iac/k8s/kube-apiserver.yaml","beginLine":8,"endLine":8,"code":"'kube-apiserver'"},"severity":"high","explanation":"Insecure bind port","resource":"iac/k8s/kube-apiserver.yaml:Pod:kube-apiserver","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.network.api_server_insecure_port.iac/k8s/kube-apiserver.yaml.8"},{"type":"network","detector":"ssh_port_exposed","framework":"dockerfile","provider":"docker","location":{"filepath":"iac/Dockerfile","beginLine":16,"endLine":16,"code":"EXPOSE 22"},"severity":"critical","explanation":"SSH port exposed","resource":"ubuntu:latest.EXPOSE","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.network.ssh_port_exposed.iac/Dockerfile.16"},{"type":"network","detector":"api_server_request_timeout","framework":"kubernetes","provider":"kubernetes","location":{"filepath":"iac/k8s/kube-apiserver.yaml","beginLine":8,"endLine":8,"code":"'kube-apiserver'"},"severity":"low","explanation":"Explicit request-timeout not set","resource":"iac/k8s/kube-apiserver.yaml:Pod:kube-apiserver","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.network.api_server_request_timeout.iac/k8s/kube-apiserver.yaml.8"},{"type":"network","detector":"alb_protected_by_waf","framework":"terraform","provider":"aws","location":{"filepath":"iac/main.tf","beginLine":59,"endLine":64,"code":"resource \"aws_lb\" \"example\" {\n  name               = var.cluster_name\n  load_balancer_type = \"application\"\n  subnets            = data.aws_subnets.default.ids\n  security_groups    = [aws_security_group.alb.id]\n}"},"severity":"low","explanation":"Public facing ALB not protected by WAF","resource":"iac/main.tf:aws_lb:example","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.network.alb_protected_by_waf.iac/main.tf.59"},{"type":"encryption","detector":"launch_config_ebs_unencrypted","framework":"terraform","provider":"aws","location":{"filepath":"iac/main.tf","beginLine":12,"endLine":27,"code":"resource \"aws_launch_configuration\" \"example\" {\n  image_id        = \"ami-0fb653ca2d3203ac1\"\n  instance_type   = var.instance_type\n  security_groups = [aws_security_group.instance.id]\n\n  user_data = templatefile(\"${path.module}/user-data.sh\", {\n    server_port = var.server_port,\n    db_address  = data.terraform_remote_state.db.outputs.address,\n    db_port     = data.terraform_remote_state.db.outputs.port\n  })\n\n  # Required when using a launch configuration with an auto scaling group.\n  lifecycle {\n    create_before_destroy = true\n  }\n}"},"severity":"critical","explanation":"Launch configurations do not have encrypted EBS volumes - TF will create unencrypted EBS root by default if root_block_device is omitted","resource":"iac/main.tf:aws_launch_configuration:example","properties":{},"tags":["in-app-code","reachable"],"issueId":"IAC.encryption.launch_config_ebs_unencrypted.iac/main.tf.12"}],"issuesAssetMapping":{"links":{},"userLinks":{}},"statistics":{"files":7,"flaws":28,"filesByKind":{"yaml":4,"dockerfile":1,"json":1,"terraform":1},"flawsByKind":{"network":10,"gensec":8,"encryption":7,"logging":1,"convention":1,"appsec":1},"detectors":447,"elapsedTime":3.630123700},"errors":[]}